<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>رصيد إجازات {{ employee.name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @media print {
            .no-print { display: none !important; }
            body { 
                font-size: 14px !important;
                margin: 0 !important;
                padding: 8px !important;
                line-height: 1.4 !important;
                font-weight: 600 !important;
                color: #000 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            .table { 
                font-size: 12px !important;
                margin-bottom: 8px !important;
                font-weight: 700 !important;
                color: #000 !important;
            }
            .table th, .table td { 
                padding: 4px 6px !important;
                line-height: 1.3 !important;
                vertical-align: middle !important;
                font-weight: 700 !important;
                color: #000 !important;
                border: 2px solid #000 !important;
            }
            .table th {
                background-color: #f0f0f0 !important;
                font-weight: 800 !important;
                color: #000 !important;
            }
            .print-header {
                margin-bottom: 15px !important;
                padding-bottom: 8px !important;
                border-bottom: 3px solid #000 !important;
            }
            .print-header h2 {
                font-size: 20px !important;
                margin-bottom: 4px !important;
                font-weight: 800 !important;
                color: #000 !important;
            }
            .print-header h3 {
                font-size: 18px !important;
                margin-bottom: 4px !important;
                font-weight: 700 !important;
                color: #000 !important;
            }
            .print-header h4 {
                font-size: 16px !important;
                margin-bottom: 4px !important;
                font-weight: 700 !important;
                color: #000 !important;
            }
            .print-header p {
                font-size: 12px !important;
                font-weight: 600 !important;
                color: #000 !important;
            }
            .employee-card {
                margin-bottom: 12px !important;
                border: 3px solid #000 !important;
                background-color: #ffffff !important;
            }
            .employee-header {
                background: #ffffff;
                color: black;
                padding: 20px;
            }
            .employee-header {
                padding: 12px !important;
                background-color: #ffffff !important;
                border-bottom: 2px solid #000 !important;
            }
            .employee-header h3 {
                font-size: 18px !important;
                margin-bottom: 4px !important;
                font-weight: 800 !important;
                color: #000 !important;
            }
            .employee-header p {
                font-size: 12px !important;
                margin-bottom: 3px !important;
                font-weight: 600 !important;
                color: #000 !important;
            }
            .employee-header h5, .employee-header h2 {
                font-size: 14px !important;
                margin-bottom: 2px !important;
                font-weight: 700 !important;
                color: #000 !important;
            }
            .balance-summary {
                padding: 12px !important;
                background-color: #f5f5f5 !important;
            }
            .balance-summary h5 {
                font-size: 14px !important;
                margin-bottom: 8px !important;
                font-weight: 800 !important;
                color: #000 !important;
            }
            .stat-card {
                padding: 6px !important;
                margin-bottom: 6px !important;
                border: 2px solid #000 !important;
                background-color: #fff !important;
            }
            .stat-number {
                font-size: 18px !important;
                margin-bottom: 3px !important;
                font-weight: 900 !important;
                color: #000 !important;
            }
            .stat-label {
                font-size: 11px !important;
                line-height: 1.3 !important;
                font-weight: 700 !important;
                color: #000 !important;
            }
            .leave-details {
                padding: 12px !important;
            }
            .leave-details h5 {
                font-size: 14px !important;
                margin-bottom: 6px !important;
                font-weight: 800 !important;
                color: #000 !important;
            }
            .badge {
                font-size: 10px !important;
                padding: 3px 5px !important;
                font-weight: 700 !important;
                color: #000 !important;
                background-color: #e0e0e0 !important;
                border: 1px solid #000 !important;
            }
            .alert {
                padding: 6px !important;
                margin-bottom: 6px !important;
                font-size: 11px !important;
                font-weight: 600 !important;
                color: #000 !important;
                background-color: #f0f0f0 !important;
                border: 2px solid #000 !important;
            }
            .card {
                margin-top: 8px !important;
                border: 2px solid #000 !important;
            }
            .card-header {
                padding: 6px 8px !important;
                background-color: #e0e0e0 !important;
                border-bottom: 2px solid #000 !important;
            }
            .card-header h6 {
                font-size: 12px !important;
                font-weight: 800 !important;
                color: #000 !important;
            }
            .card-body {
                padding: 6px 8px !important;
            }
            .card-body li {
                font-size: 10px !important;
                margin-bottom: 3px !important;
                font-weight: 600 !important;
                color: #000 !important;
            }
            .text-center.mt-4 {
                margin-top: 8px !important;
                padding-top: 5px !important;
                border-top: 2px solid #000 !important;
            }
            .text-center.mt-4 p {
                font-size: 10px !important;
                margin-bottom: 2px !important;
                font-weight: 600 !important;
                color: #000 !important;
            }
            .row {
                margin: 0 !important;
            }
            .col-md-2, .col-md-3, .col-md-4, .col-md-6, .col-md-8 {
                padding: 2px !important;
            }
            /* تخطيط الأرصدة في صف واحد */
            .balance-row {
                display: flex !important;
                flex-wrap: wrap !important;
                gap: 4px !important;
            }
            .balance-col {
                flex: 1 !important;
                min-width: 0 !important;
            }
            .page-break { page-break-before: always; }
            
            /* تحسين وضوح النصوص */
            * {
                font-weight: 600 !important;
                color: #000 !important;
            }
            
            h1, h2, h3, h4, h5, h6 {
                font-weight: 800 !important;
                color: #000 !important;
            }
            
            strong, b {
                font-weight: 900 !important;
                color: #000 !important;
            }
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        
        .print-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #007bff;
            padding-bottom: 20px;
        }
        .employee-card {
            border: 2px solid #007bff;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 30px;
            background-color: #ffffff;
        }
        
        .employee-header {
            background: #ffffff;
            color: #000000;
            padding: 20px;
        }
        
        .balance-summary {
            background-color: #ffffff;
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .leave-details {
            padding: 20px;
        }
        
        .stat-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            margin-bottom: 15px;
            background-color: #ffffff;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .badge {
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <!-- ترويسة التقرير -->
    <div class="print-header">
        <h2 class="text-primary mb-2">مديرية التربية والتعليم لمنطقة الزرقاء الثانية</h2>
        <h3 class="text-secondary mb-2">قسم شؤون الموظفين</h3>
        <h3 class="mb-2">بيان رصيد الإجازات</h3>
        <h4 class="mb-2">للسنة {{ current_year }}</h4>
        <p class="mb-0">تاريخ الطباعة: {{ print_date.strftime('%Y-%m-%d %H:%M') }}</p>
    </div>

    <!-- أزرار التحكم -->
    <div class="no-print mb-3 text-center">
        <button onclick="window.print()" class="btn btn-primary me-2">
            <i class="fas fa-print"></i> طباعة
        </button>
        <button onclick="window.close()" class="btn btn-secondary">
            <i class="fas fa-times"></i> إغلاق
        </button>
    </div>

    <!-- بيانات الموظف -->
    <div class="employee-card">
        <!-- معلومات الموظف -->
        <div class="employee-header">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h3 class="mb-2"><i class="fas fa-user"></i> {{ employee.name }}</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <p class="mb-1"><strong>الرقم الوزاري:</strong> {{ employee.ministry_number }}</p>
                            <p class="mb-0"><strong>الرقم المدني:</strong> {{ employee.civil_id }}</p>
                        </div>
                        <div class="col-md-6">
                            <p class="mb-1"><strong>القسم:</strong> {{ employee.school.name }}</p>
                            <p class="mb-0"><strong>الوظيفة:</strong> {{ employee.job_title }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 text-end">
                    <div class="bg-white bg-opacity-25 rounded p-3">
                        <h5 class="mb-0">السنة المالية</h5>
                        <h2 class="mb-0">{{ current_year }}</h2>
                    </div>
                </div>
            </div>
        </div>

        <!-- ملخص الرصيد -->
        <div class="balance-summary">
            <h5 class="text-center mb-4"><i class="fas fa-chart-bar"></i> ملخص رصيد الإجازات</h5>
            <!-- جميع الأرصدة في صف واحد -->
            <div class="row balance-row">
                <div class="col-md-2 balance-col">
                    <div class="stat-card">
                        <div class="stat-number text-info">{{ balance.current_year_balance }}</div>
                        <div class="stat-label">رصيد السنة الحالية</div>
                    </div>
                </div>
                <div class="col-md-2 balance-col">
                    <div class="stat-card">
                        <div class="stat-number text-secondary">{{ balance.previous_year_balance }}</div>
                        <div class="stat-label">رصيد السنة السابقة</div>
                    </div>
                </div>
                <div class="col-md-2 balance-col">
                    <div class="stat-card">
                        <div class="stat-number text-primary">{{ balance.current_year_balance + balance.previous_year_balance }}</div>
                        <div class="stat-label">إجمالي الرصيد السنوي</div>
                    </div>
                </div>
                <div class="col-md-2 balance-col">
                    <div class="stat-card">
                        <div class="stat-number text-info">{{ balance.sick_leave_balance }}</div>
                        <div class="stat-label">رصيد الإجازات المرضية</div>
                    </div>
                </div>
                <div class="col-md-2 balance-col">
                    <div class="stat-card">
                        <div class="stat-number text-warning">{{ balance.used_annual_leave }}</div>
                        <div class="stat-label">الإجازات السنوية المستخدمة</div>
                    </div>
                </div>
                <div class="col-md-2 balance-col">
                    <div class="stat-card">
                        {% set remaining_annual = balance.get_remaining_annual_balance() %}
                        <div class="stat-number {% if remaining_annual < 5 %}text-danger{% elif remaining_annual < 10 %}text-warning{% else %}text-success{% endif %}">
                            {{ remaining_annual }}
                        </div>
                        <div class="stat-label">الرصيد السنوي المتبقي</div>
                    </div>
                </div>
            </div>
            
            <!-- الرصيد المرضي المتبقي في صف منفصل إذا لزم الأمر -->
            <div class="row mt-2">
                <div class="col-md-12">
                    <div class="stat-card">
                        {% set remaining_sick = balance.get_remaining_sick_balance() %}
                        <div class="stat-number {% if remaining_sick < 3 %}text-danger{% elif remaining_sick < 7 %}text-warning{% else %}text-success{% endif %}">
                            {{ remaining_sick }}
                        </div>
                        <div class="stat-label">الرصيد المرضي المتبقي</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- تفاصيل الإجازات -->
        <div class="leave-details">
            <div class="row">
                <!-- الإجازات السنوية -->
                <div class="col-md-4">
                    <h5 class="text-primary mb-3">
                        <i class="fas fa-calendar-alt"></i> الإجازات السنوية المستخدمة
                        <span class="badge bg-primary">{{ annual_leaves|length }}</span>
                    </h5>
                    {% if annual_leaves %}
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered">
                            <thead class="table-primary">
                                <tr>
                                    <th>النوع</th>
                                    <th>من</th>
                                    <th>إلى</th>
                                    <th>الأيام</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in annual_leaves %}
                                <tr>
                                    <td>
                                        <span class="badge bg-success">{{ item.category }}</span><br>
                                        <small>{{ item.leave.leave_type }}</small>
                                    </td>
                                    <td>{{ item.leave.start_date.strftime('%Y-%m-%d') }}</td>
                                    <td>{{ item.leave.end_date.strftime('%Y-%m-%d') }}</td>
                                    <td class="text-center">
                                        <span class="badge bg-warning">{{ item.leave.days_count }}</span>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                            <tfoot class="table-light">
                                <tr>
                                    <th colspan="3" class="text-end">المجموع:</th>
                                    <th class="text-center">
                                        <span class="badge bg-primary">{{ annual_leaves|sum(attribute='leave.days_count') }}</span>
                                    </th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    {% else %}
                    <div class="alert alert-info text-center">
                        <i class="fas fa-info-circle"></i> لا توجد إجازات سنوية مستخدمة
                    </div>
                    {% endif %}
                </div>

                <!-- الإجازات المرضية -->
                <div class="col-md-4">
                    <h5 class="text-danger mb-3">
                        <i class="fas fa-user-injured"></i> الإجازات المرضية المستخدمة
                        <span class="badge bg-danger">{{ sick_leaves|length }}</span>
                    </h5>
                    {% if sick_leaves %}
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered">
                            <thead class="table-danger">
                                <tr>
                                    <th>النوع</th>
                                    <th>من</th>
                                    <th>إلى</th>
                                    <th>الأيام</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in sick_leaves %}
                                <tr>
                                    <td>
                                        <span class="badge bg-danger">{{ item.category }}</span><br>
                                        <small>{{ item.leave.leave_type }}</small>
                                    </td>
                                    <td>{{ item.leave.start_date.strftime('%Y-%m-%d') }}</td>
                                    <td>{{ item.leave.end_date.strftime('%Y-%m-%d') }}</td>
                                    <td class="text-center">
                                        <span class="badge bg-danger">{{ item.leave.days_count }}</span>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                            <tfoot class="table-light">
                                <tr>
                                    <th colspan="3" class="text-end">المجموع:</th>
                                    <th class="text-center">
                                        <span class="badge bg-danger">{{ sick_leaves|sum(attribute='leave.days_count') }}</span>
                                    </th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    {% else %}
                    <div class="alert alert-success text-center">
                        <i class="fas fa-check-circle"></i> لا توجد إجازات مرضية مستخدمة
                    </div>
                    {% endif %}
                </div>

                <!-- المغادرات المحولة -->
                <div class="col-md-4">
                    <h5 class="text-warning mb-3">
                        <i class="fas fa-exchange-alt"></i> المغادرات المحولة
                        <span class="badge bg-warning">{{ converted_departures|length }}</span>
                    </h5>
                    {% if converted_departures %}
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered">
                            <thead class="table-warning">
                                <tr>
                                    <th>النوع</th>
                                    <th>الشهر المرحل</th>
                                    <th>من</th>
                                    <th>إلى</th>
                                    <th>الأيام</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in converted_departures %}
                                <tr>
                                    <td>
                                        <span class="badge bg-warning text-dark">{{ item.category }}</span><br>
                                        <small>{{ item.leave.leave_type }}</small>
                                    </td>
                                    <td class="text-center">
                                        {% if item.converted_month %}
                                            <span class="badge bg-info">{{ item.converted_month }}</span>
                                        {% else %}
                                            <span class="text-muted">-</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ item.leave.start_date.strftime('%Y-%m-%d') }}</td>
                                    <td>{{ item.leave.end_date.strftime('%Y-%m-%d') }}</td>
                                    <td class="text-center">
                                        <span class="badge bg-warning text-dark">{{ item.leave.days_count }}</span>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                            <tfoot class="table-light">
                                <tr>
                                    <th colspan="4" class="text-end">المجموع:</th>
                                    <th class="text-center">
                                        <span class="badge bg-warning text-dark">{{ converted_departures|sum(attribute='leave.days_count') }}</span>
                                    </th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    {% else %}
                    <div class="alert alert-info text-center">
                        <i class="fas fa-info-circle"></i> لا توجد مغادرات محولة
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- ملاحظات -->
    <div class="card mt-4">
        <div class="card-header bg-light">
            <h6 class="mb-0"><i class="fas fa-sticky-note"></i> ملاحظات مهمة</h6>
        </div>
        <div class="card-body">
            <ul class="list-unstyled mb-0">
                <li class="mb-2"><i class="fas fa-info-circle text-info"></i> الرصيد الافتراضي للإجازات السنوية: 30 يوم</li>
                <li class="mb-2"><i class="fas fa-info-circle text-info"></i> الرصيد الافتراضي للإجازات المرضية: 7 أيام</li>
                <li class="mb-2"><i class="fas fa-exclamation-triangle text-warning"></i> يتم خصم الإجازات السنوية من مجموع الرصيد (الحالي + السابق)</li>
                <li class="mb-0"><i class="fas fa-exclamation-triangle text-warning"></i> يتم خصم الإجازات المرضية من رصيد الإجازات المرضية</li>
            </ul>
        </div>
    </div>

    <!-- تذييل التقرير -->
    <div class="text-center mt-4 pt-3 border-top">
        <p class="text-muted mb-1">تم إنشاء هذا التقرير بواسطة نظام إدارة شؤون الموظفين (وائل المشاقبة)</p>
        <p class="text-muted mb-0">مديرية تربية والتعليم لمنطقة الزرقاء الثانية / قسم شؤون الموظفين  - {{ print_date.strftime('%Y') }}</p>
    </div>

    <script>
        // طباعة تلقائية عند فتح الصفحة (اختياري)
        // window.onload = function() { window.print(); }
    </script>
</body>
</html>